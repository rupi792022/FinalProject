<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <link href="../css/VolunteerLearning.css" rel="stylesheet" />
    <title></title>
    <script>
        $(document).ready(function () {
             //getDatails = JSON.parse(localStorage.getItem('userDetails'));
            //ajaxCall("GET", "../api/Volunteers/ReadDetails_V?email=" + userDetails.Volunteer_email, "", getSuccessDetails_v, getErrorDetails_v);

            let apiCall = "../api/GuidingPrograms/Read_GP";
            ajaxCall("GET", apiCall, "", getSuccessGP, getErrorGP);

            $(document).on("click", ".btnLevel", adi);

            //$("#next").hide();
            //$("#check").hide();
            //$("#continue").hide();
            //$("#startLearning").click(startLearning);
            //$("#next").click(Next);
            //$("#check").click(Check);
            //$("#continue").click(Continue);
            //NumOfLevel = 0;
            //numOfQuestion = 0;

        });

        //function getSuccessDetails_v(volunteerDetails) {
        //    console.log(volunteerDetails);
        //    var user = $('<a class= "dropdown-toggle" data-toggle="dropdown" href="#">' + volunteerDetails.first_name + ' ' + volunteerDetails.last_name + '<span class= "caret"></span></a><ul class="dropdown-menu"><li><a href="#">Personal details</a></li><li><a href="#">Log out</a></li></ul>');
        //    $(user).clone().appendTo(".dropdown");
        //}

        //function getErrorDetails_v(error) {
        //    console.log(error)
        //}


        function getSuccessGP(gp) {
            console.log("Success GP")
            str = "";
            for (var i = 0; i < gp.length; i++) {
                str += '<button type="button" class="btnLevel" id="' + (i + 1) + '"> Level' + (i + 1) + '</button >';
            }
            document.getElementById("learning").innerHTML = str;

        }

        function getErrorGP() {
            console.log("the GP is not read")
        }



        function adi() {
            let levelNum = $(this).attr("id");
            const fileList = event.target.files;            let fileContent = "";            const fr = new FileReader();            fr.onload = () => {                fileContent = fr.result;                console.log('Commands', fileContent);            }            fr.readAsText(fileList[0]);

        }



        function startLearning() {//geting the values from GuidingPrograms
            NumOfLevel++;
            let apiCall = "../api/GuidingPrograms/Read_GP?level_serial_num=" + NumOfLevel;
            ajaxCall("GET", apiCall, "", getSuccess, getError);
        }

        //function getSuccess(GP_Details) {//render on a html the content and file
        //    console.log(GP_Details);
        //    $("#next").show();
        //    let str = "";
        //    str += "<p>" + GP_Details.Content_level + "</p>";
        //      /*    str += "<p>" + GP_Details.+ "</p>";*/

        //    $("#learning").html(str);
        //}

        function getError() {
            console.log("err");
        }

        function Next(GP_Details) {
            $("#learning").remove();//remove the content and file
            numOfQuestion++;

            var Question = [];//array of all the questions
            Question.push(GP_Details.Question_content_1, GP_Details.Question_content_2, GP_Details.Question_content_3, GP_Details.Question_content_4);

            arrAnswers_1 = GP_Details.Answers_1.split(",");//array for answers to question 1
            correct_answer1 = arrAnswers_1[0];//save correct answer for question 1
            arrAnswers_1 = arrAnswers_1.sort(() => Math.random() - 0.5);//shuffle the arr

            arrAnswers_2 = GP_Details.Answers_2.split(",");//array for answers to question 2
            correct_answer2 = arrAnswers_2[0];//save correct answer for question 2
            arrAnswers_2 = arrAnswers_2.sort(() => Math.random() - 0.5);//shuffle the arr

            arrAnswers_3 = GP_Details.Answers_3.split(",");//array for answers to question 3
            correct_answer3 = arrAnswers_3[0];//save correct answer for question 3
            arrAnswers_3 = arrAnswers_3.sort(() => Math.random() - 0.5);//shuffle the arr

            arrAnswers_4 = GP_Details.Answers_4.split(",");//array for answers to question 4
            correct_answer4 = arrAnswers_4[0];//save correct answer for question 4
            arrAnswers_4 = arrAnswers_4.sort(() => Math.random() - 0.5);//shuffle the arr

            allAnswersArr = arrAnswers_1.concat(arrAnswers_2, arrAnswers_3, arrAnswers_4);//arr for all the answers.
            allCorrectAnswersArr = [];//arr for all the correct answers.
            allCorrectAnswersArr.push(correct_answer1, correct_answer2, correct_answer3, correct_answer4);

            startPoint = 0;
            endPoint = 4;
            count = 0;//count the number of answer
            str = "";//render on a html the question and answers
            for (var i = 0; i < Question.length; i++) {
                if (Question[i] != null) {
                    str += "<p>" + Question[i] + "</p>";
                    for (startPoint; i < endPoint; i++) {
                        str += '<input type="radio" id="answer' + count + '" name="answer" value="' + allAnswersArr[i] + '"><label for="answer' + count + '">' + allAnswersArr[i] + '</label><br>';
                        count++;
                    }
                    startPoint += 4;
                    endPoint += 4;
                }
            }
            document.getElementById("QA").innerHTML = str;
            $("#next").hide();
            $("#check").show();
        }

        function Check() {//check if the answer is correct
            let SelectedAnswer = $("input[type=radio][name=answer]:checked").val();//get the value from the checkbox
            if (SelectedAnswer) {
                console.log(SelectedAnswer);
            }
            else alert('No Answer selected');

            for (var i = 0; i < length; i++) {
                if (SelectedAnswer == allCorrectAnswersArr[i]) {//check if the answer is correct
                    alert("Good Job! The answer is correct")
                }
                else alert("Sorry, The answer is incorrect")
            }

            //if (numOfQuestion == /*Question.length*/) {//check if the level is finish
            //    $("#continue").show();
            //    $("#next").hide();
            //}
            //$("#next").show();
        }

        function Continue() {
            startLearning();
        }

    </script>
</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <img src="../Images/FOA.png" />
            </div>
            <ul class="nav navbar-nav">
                <li><a class="space" href="VolunteerHome.html">Home</a></li>
                <li><a class="space" href="#">לומדה</a></li>
                <li><a class="space" href="#">Activity time</a></li>
                <li><a class="space" href="#">Reports</a></li>
                <li><a class="space" href="#">Keywords</a></li>
                <li class="dropdown"></li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div id="learning"></div>
        <div id="QA"></div>
        <!--<button type="submit" id="startLearning">Start learning</button><br>
        <button type="submit" id="next">Next</button><br>
        <button type="submit" id="check">Check</button><br>
        <button type="submit" id="continue">Continue</button><br>-->
    </div>
</body>
</html>
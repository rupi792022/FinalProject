<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <link href="../css/Dashbord.css" rel="stylesheet" />
    <title></title>
    <script>

        $(document).ready(function () {
            getDatails = JSON.parse(localStorage.getItem('managerDetails'));
            var user = $('<a class= "dropdown-toggle" data-toggle="dropdown" href="#">' + getDatails.First_name + ' ' + getDatails.Last_name + '<span class= "caret"></span></a><ul class="dropdown-menu"><li><a href="SingIn.html">Add volunteer</a></li><li><a onclick="logOut()">Log out</a></li></ul>');
            $(user).clone().appendTo(".dropdown");

            let apiCall = "../api/Twitters/getTweets";
            ajaxCall("GET", apiCall, "", getSuccessGetTweets, getErrorGetTweets);
            //var date = dateAndTime.Date;
        });

        function logOut() {
            localStorage.clear();
            window.location.href = "LogIn.html";
        }

        function getSuccessGetTweets(allTweets) {
            var dictStatus = {};
            var dictCountry = {};
            var dictYear = {};
            ListOfYears = []
            ListOfValues = [];
            Years = [];
            for (var i = 0; i < allTweets.length; i++) {
                if (dictCountry[allTweets[i].Country] === undefined) {
                    dictCountry[allTweets[i].Country] = 1;
                }
                else {
                    dictCountry[allTweets[i].Country] = dictCountry[allTweets[i].Country] + 1;
                }

                if (dictStatus[allTweets[i].Status] === undefined) {
                    dictStatus[allTweets[i].Status] = 1;
                }
                else {
                    dictStatus[allTweets[i].Status] = dictStatus[allTweets[i].Status] + 1;
                }
                if (dictYear[allTweets[i].Submit_time] === undefined) {
                    dictYear[allTweets[i].Submit_time] = 1;
                }
                else {
                    dictYear[allTweets[i].Submit_time] = dictYear[allTweets[i].Submit_time] + 1;
                }

                //ListOfYears.push(allTweets[i].Submit_time);
                //Years = removeDuplicates(ListOfYears);
            }
            removed_list = [];
            count_statuses = 0;
            for (let k in dictYear) {
                ListOfValues.push(dictYear[k]);
                Years.push(k);
            }
            for (var j = 0; j < Years.length; j++) {
                for (var i = 0; i < allTweets.length; i++) {
                    if (Years[j] == allTweets[i].Submit_time && allTweets[i].Status == "Removed") {
                        count_statuses++;
                    }
                }
                removed_list.push(count_statuses);
                count_statuses = 0;
            }
           
            dashboard();
        }

        function getErrorGetTweets(error) {
            console.log(error);
        }

        function dashboard() {
            new Chart("myChart", {
                type: "bar",     
            data: {
                labels: Years,
                    datasets: [{
                        backgroundColor: 'red',
                        label: 'All Reports',
                        data: ListOfValues
                    }, {
                        backgroundColor: 'blue',
                        label: 'Removed',
                        data: removed_list
                    }]
                },

                options: {
                    legend: { display: true },
                    title: {
                        display: true,
                        text: "Total reports & removed reports"
                    },
                    scales: {
                        yAxes: [{
                            ticks: { min: 0 }
                        }],
                    }
                }
            });

        }

    </script>

</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <img class="logoFOA" src="../Images/FOA.png" />
            </div>
            <ul class="nav navbar-nav">
                <li><a class="space" href="ManagerHome.html">Home</a></li>
                <li><a class="space" href="GuidingProgram.html">Guiding Program</a></li>
                <li><a class="space" href="MonitoringReport.html">Reports</a></li>
                <li><a class="space" href="Dashboard.html">Dashbord</a></li>
                <li><a class="space" href="KeyWord.html">Keywords</a></li>
                <li><a class="space" href="CommonUsers.html">Common Users</a></li>
                <li class="dropdown"></li>
            </ul>
        </div>
    </nav>
    <div class="loginBox">
        <div class="inputBox">
            <p id="dashbordHeader">Dashbord</p>
            <canvas id="myChart" style="width:100%;max-width:600px"></canvas>
            <!--<div id="chartContainer" style="height: 370px; width: 100%;"></div>
            <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
            <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>-->
        </div>
    </div>
</body>
</html>